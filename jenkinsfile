// pipeline {
//     agent any

//     stages {
//         stage('Checkout') {
//             steps {
//                 git url: 'https://github.com/Chebbi-hamdi/backUp.git', branch: 'main'
//             }
//         }
//         stage('Build') {
//             steps {
//                 echo 'Building...'
//                 // Add build steps here
//             }
//         }
//         stage('Test') {
//             steps {
//                 echo 'Testing...'
//                 // Add test steps here
//             }
//         }
//         stage('Deploy') {
//             steps {
//                 echo 'Deploying...'
//                 // Add deploy steps here
//             }
//         }
//     }
// }
/** working with stages */
pipeline {
    agent any

    environment {
        DOCKER_IMAGE = 'node:18.15.0' // Define the Docker image to use
    }

    stages {
        stage('Checkout') {
            steps {
                git url: 'https://github.com/Chebbi-hamdi/backUp.git', branch: 'main' // Checkout the code from the repository
            }
        }
        stage('Build') {
            steps {
                echo 'Building...'
                script {
                    // Build the Docker image using the Dockerfile in the repository root
                    bat 'docker build -t node:18.15.0 -f Dockerfile .'
                }
            }
        }
        stage('Test') {
            steps {
                echo 'Testing...'
                // Add test steps here
            }
        }
        stage('Deploy') {
            steps {
                echo 'Deploying...'
                // Add deploy steps here
                script {
                    // Run the Docker container
                    bat 'docker run -d -p 5000:5000 node:18.15.0'
                }
            }
        }
    }

    post {
        always {
            script {
                // Clean up Docker container after build
                bat 'docker stop $(docker ps -q --filter ancestor=node:18.15.0)'
            }
        }
        success {
            echo 'Build succeeded!'
        }
        failure {
            echo 'Build failed!'
        }
    }
}
